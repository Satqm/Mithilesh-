<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Classes - Mr. Mithilesh</title>
    <link rel="manifest" href="manifest.json">
    <!-- Firebase & UI Libraries -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3a86ff;
            --secondary: #8338ec;
            --success: #06d6a0;
            --warning: #ffd166;
            --danger: #ef476f;
            --light: #f8f9fa;
            --dark: #212529;
            --gold: #FFD700;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #f5f7fb 0%, #e4edf5 100%);
            color: var(--dark);
            padding: 20px;
            min-height: 100vh;
        }

        /* Login Screen */
        .login-container {
            max-width: 400px;
            margin: 50px auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            text-align: center;
            animation: fadeInUp 0.8s ease;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-icon {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 15px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .logo h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .logo p {
            color: #666;
            font-size: 1rem;
        }

        .login-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .option-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option-card:hover {
            background: white;
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(58, 134, 255, 0.1);
        }

        .option-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .option-card h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .option-card p {
            color: #666;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-group label.required:after {
            content: " *";
            color: var(--danger);
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: 0.3s;
            background: #f8f9fa;
        }

        .form-control:focus {
            border-color: var(--primary);
            background: white;
            outline: none;
            box-shadow: 0 0 0 3px rgba(58, 134, 255, 0.1);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(58, 134, 255, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            animation: slideInDown 0.6s ease;
        }

        @keyframes slideInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: white;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            overflow-x: auto;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            -webkit-overflow-scrolling: touch;
            animation: fadeIn 0.8s ease;
        }

        .nav-tab {
            flex: 1;
            min-width: 120px;
            padding: 18px 12px;
            text-align: center;
            cursor: pointer;
            border-bottom: 4px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
            font-family: 'Poppins', sans-serif;
        }

        .nav-tab:hover {
            background: #f8f9fa;
        }

        .nav-tab.active {
            border-bottom: 4px solid var(--primary);
            color: var(--primary);
            background: #f0f5ff;
        }

        .nav-tab i {
            margin-right: 8px;
            font-size: 1.1rem;
        }

        /* Content Sections */
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .stat-info h3 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-info p {
            color: #666;
            font-size: 0.95rem;
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            overflow-x: auto;
            animation: fadeIn 0.6s ease;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #f8f9fa;
            padding: 18px 20px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #eee;
            font-family: 'Poppins', sans-serif;
        }

        .table td {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
        }

        .table tr:hover {
            background: #f9f9f9;
        }

        /* Badges */
        .badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-block;
        }

        .badge-success {
            background: rgba(6, 214, 160, 0.15);
            color: var(--success);
            border: 1px solid rgba(6, 214, 160, 0.3);
        }

        .badge-warning {
            background: rgba(255, 209, 102, 0.15);
            color: #e6a700;
            border: 1px solid rgba(255, 209, 102, 0.3);
        }

        .badge-danger {
            background: rgba(239, 71, 111, 0.15);
            color: var(--danger);
            border: 1px solid rgba(239, 71, 111, 0.3);
        }

        .badge-info {
            background: rgba(58, 134, 255, 0.15);
            color: var(--primary);
            border: 1px solid rgba(58, 134, 255, 0.3);
        }

        /* Student Cards - NEW IMPROVED DESIGN */
        .student-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border-left: 5px solid var(--primary);
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 20px;
            align-items: start;
        }

        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.12);
        }

        .student-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            border: 4px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .student-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .student-info-item {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 10px;
            border-left: 3px solid var(--primary);
        }

        .student-info-item strong {
            display: block;
            color: var(--primary);
            font-size: 0.85rem;
            margin-bottom: 5px;
            font-family: 'Poppins', sans-serif;
        }

        .student-info-item span {
            color: var(--dark);
            font-size: 1rem;
        }

        /* Test Cards */
        .test-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border-left: 5px solid var(--primary);
        }

        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.12);
        }

        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .test-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--dark);
        }

        .test-class {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .test-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Star Rating */
        .star-rating {
            display: flex;
            flex-direction: row-reverse;
            justify-content: center;
            gap: 5px;
        }

        .star-rating input {
            display: none;
        }

        .star-rating label {
            cursor: pointer;
            width: 40px;
            height: 40px;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 24 24' fill='%23ddd'%3e%3cpath d='M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            transition: all 0.3s;
        }

        .star-rating input:checked ~ label,
        .star-rating input:hover ~ label,
        .star-rating label:hover,
        .star-rating label:hover ~ label {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 24 24' fill='%23FFD700'%3e%3cpath d='M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z'/%3e%3c/svg%3e");
        }

        .rating-text {
            text-align: center;
            margin-top: 10px;
            font-size: 1.1rem;
            color: #666;
            min-height: 24px;
        }

        /* About Section */
        .about-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            animation: fadeIn 0.8s ease;
        }

        .teacher-profile {
            text-align: center;
            margin-bottom: 40px;
        }

        /* BIGGER PHOTO FRAME */
        .teacher-photo {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            margin: 0 auto 25px;
            overflow: hidden;
            border: 6px solid white;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .teacher-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .teacher-info h2 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Poppins', sans-serif;
        }

        .teacher-info p {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .contact-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: #f8f9fa;
            border-radius: 50px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .contact-item:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(58, 134, 255, 0.3);
        }

        .contact-item:hover i {
            color: white;
        }

        .contact-item i {
            color: var(--primary);
            font-size: 1.2rem;
        }

        .qualification-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }

        .qualification-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid var(--primary);
            transition: all 0.3s ease;
        }

        .qualification-card:hover {
            transform: translateY(-5px);
            background: white;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .qualification-card h4 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: var(--primary);
            font-family: 'Poppins', sans-serif;
        }

        .qualification-card p {
            color: #666;
            line-height: 1.6;
        }

        .qualification-card ul {
            list-style: none;
            padding-left: 0;
        }

        .qualification-card li {
            padding: 8px 0;
            color: #666;
            position: relative;
            padding-left: 25px;
        }

        .qualification-card li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: bold;
        }

        /* Feedback Section */
        .feedback-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .feedback-form {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px dashed var(--primary);
        }

        .feedback-list {
            display: grid;
            gap: 20px;
        }

        .feedback-item {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary);
            transition: transform 0.3s ease;
        }

        .feedback-item:hover {
            transform: translateY(-3px);
        }

        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .feedback-stars {
            color: var(--gold);
            font-size: 1.2rem;
        }

        .feedback-date {
            color: #999;
            font-size: 0.9rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.4s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        .modal-body {
            padding: 25px;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .loading i {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tab {
                min-width: 100px;
                padding: 15px 8px;
                font-size: 0.9rem;
            }
            
            .table {
                min-width: 600px;
            }
            
            .contact-info {
                flex-direction: column;
                align-items: center;
            }
            
            .qualification-grid {
                grid-template-columns: 1fr;
            }
            
            .teacher-photo {
                width: 200px;
                height: 200px;
            }
            
            .student-card {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .student-avatar {
                margin: 0 auto;
            }
        }

        /* Student View Styles */
        .read-only-notice {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
            animation: slideInDown 0.6s ease;
            box-shadow: 0 8px 20px rgba(58, 134, 255, 0.2);
        }

        .student-warning {
            background: linear-gradient(135deg, var(--warning), #ffc107);
            color: var(--dark);
            padding: 12px 18px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            border-left: 4px solid #e6a700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Password Info */
        .password-note {
            background: #e8f4ff;
            border: 2px dashed var(--primary);
            padding: 12px 15px;
            margin-top: 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            color: var(--dark);
        }

        .password-note i {
            color: var(--primary);
            margin-right: 8px;
        }

        /* Success Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            display: none;
            z-index: 9999;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast i {
            margin-right: 10px;
        }

        /* Student Dashboard Cards */
        .student-dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            text-align: center;
        }

        .student-dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.12);
        }

        .student-dashboard-card i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .student-dashboard-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .student-dashboard-card p {
            color: #666;
            line-height: 1.5;
        }

        /* Action Buttons for Teacher */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .action-btn-primary {
            background: var(--primary);
            color: white;
        }

        .action-btn-danger {
            background: var(--danger);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-square-root-alt"></i>
            </div>
            <h1>Math Classes</h1>
            <p>By Mr. Mithilesh - Excellence in Mathematics</p>
        </div>
        
        <div class="login-options">
            <div class="option-card" onclick="showTeacherLogin()">
                <i class="fas fa-chalkboard-teacher"></i>
                <h3>Teacher Login</h3>
                <p>Access full management dashboard</p>
            </div>
            
            <div class="option-card" onclick="enterStudentMode()">
                <i class="fas fa-user-graduate"></i>
                <h3>Student Access</h3>
                <p>View classes, download tests, submit feedback</p>
            </div>
        </div>

        <div id="teacherLoginForm" style="display: none; margin-top: 30px;">
            <div class="password-note">
                <i class="fas fa-lock"></i>
                <span>Use teacher password for access</span>
            </div>
            <div class="form-group">
                <label>Teacher Email Address</label>
                <input type="email" id="loginEmail" class="form-control" placeholder="mithilesh.maths@gmail.com">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="loginPassword" class="form-control" placeholder="Enter password">
            </div>
            <button class="btn btn-primary" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> Teacher Login
            </button>
            <button class="btn btn-outline" onclick="showLoginOptions()" style="margin-top: 15px;">
                <i class="fas fa-arrow-left"></i> Back to Options
            </button>
        </div>
    </div>

    <!-- Main App (hidden until login) -->
    <div id="app" style="display: none;">
        <!-- Student View Notice -->
        <div id="studentNotice" class="read-only-notice" style="display: none;">
            <i class="fas fa-user-graduate"></i> 
            <strong>STUDENT VIEW - READ ONLY ACCESS</strong>
            <p style="margin-top: 5px; font-size: 0.9rem; opacity: 0.9;">You can view information and submit feedback</p>
        </div>

        <!-- Header -->
        <header>
            <div class="header-content">
                <div>
                    <h2 id="welcomeMessage">Welcome!</h2>
                    <p id="userRole">Loading...</p>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">M</div>
                    <button class="btn btn-outline" onclick="logout()" style="padding: 10px 20px;" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showSection('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </div>
            <div class="nav-tab" onclick="showSection('students')">
                <i class="fas fa-user-graduate"></i> Students
            </div>
            <div class="nav-tab" onclick="showSection('attendance')">
                <i class="fas fa-calendar-check"></i> Attendance
            </div>
            <div class="nav-tab" onclick="showSection('tests')">
                <i class="fas fa-file-pdf"></i> Tests & Quizzes
            </div>
            <div class="nav-tab" onclick="showSection('feedback')" id="feedbackTab">
                <i class="fas fa-star"></i> Feedback
            </div>
            <div class="nav-tab" onclick="showSection('about')">
                <i class="fas fa-user-tie"></i> About Teacher
            </div>
        </div>

        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalStudents">0</h3>
                        <p>Total Students</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="attendancePercent">0%</h3>
                        <p>Today's Attendance</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-rupee-sign"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="feesCollected">₹0</h3>
                        <p>This Month's Fees</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="pendingFees">₹0</h3>
                        <p>Pending Fees</p>
                    </div>
                </div>
            </div>

            <div id="studentDashboard" style="display: none;">
                <div class="student-warning">
                    <i class="fas fa-info-circle"></i> 
                    You're viewing in read-only mode. Contact teacher for any changes.
                </div>
                
                <div class="stats-grid">
                    <div class="student-dashboard-card">
                        <i class="fas fa-user-graduate"></i>
                        <h3>View Students</h3>
                        <p>See all registered students in the class</p>
                    </div>
                    <div class="student-dashboard-card">
                        <i class="fas fa-calendar-check"></i>
                        <h3>Check Attendance</h3>
                        <p>View your attendance records</p>
                    </div>
                    <div class="student-dashboard-card">
                        <i class="fas fa-file-pdf"></i>
                        <h3>Download Tests</h3>
                        <p>Access monthly tests and quizzes</p>
                    </div>
                    <div class="student-dashboard-card">
                        <i class="fas fa-star"></i>
                        <h3>Submit Feedback</h3>
                        <p>Share your experience with teacher</p>
                    </div>
                </div>
            </div>

            <h3 style="margin: 25px 0 15px; font-family: 'Poppins', sans-serif;">Recent Activities</h3>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Activity</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="activitiesList">
                        <tr><td colspan="3" class="loading">Loading activities...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Students Section -->
        <section id="students" class="content-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-family: 'Poppins', sans-serif;">
                    <i class="fas fa-user-graduate"></i> 
                    <span id="studentsTitle">Student Management</span>
                </h3>
                <button class="btn btn-primary" onclick="openAddStudentModal()" id="addStudentBtn" style="display: none;">
                    <i class="fas fa-plus"></i> Add Student
                </button>
            </div>

            <div class="student-warning" id="studentViewWarning" style="display: none;">
                <i class="fas fa-eye"></i> 
                <span>Read-only view - You can see student information but cannot make changes</span>
            </div>

            <div class="form-group">
                <input type="text" id="studentSearch" class="form-control" 
                       placeholder="Search students by name, class, or father's name..." 
                       onkeyup="searchStudents()">
            </div>

            <div id="studentsList">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading students...</p>
                </div>
            </div>
        </section>

        <!-- Attendance Section -->
        <section id="attendance" class="content-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-family: 'Poppins', sans-serif;">
                    <i class="fas fa-calendar-check"></i> 
                    Attendance Tracking
                </h3>
                <div id="attendanceActions" style="display: none;">
                    <select id="attendanceMonth" class="form-control" style="width: auto; display: inline-block;" onchange="loadAttendance()">
                        <option value="current">Current Month</option>
                        <option value="prev1">Last Month</option>
                        <option value="prev2">2 Months Ago</option>
                    </select>
                    <button class="btn btn-primary" onclick="markAttendanceToday()" style="margin-left: 10px;">
                        <i class="fas fa-check"></i> Mark Today
                    </button>
                </div>
            </div>

            <div class="student-warning" id="attendanceWarning" style="display: none;">
                <i class="fas fa-info-circle"></i> 
                Attendance view only - Updates made by teacher
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Class</th>
                            <th>Today</th>
                            <th>This Week</th>
                            <th>This Month</th>
                            <th>Attendance %</th>
                        </tr>
                    </thead>
                    <tbody id="attendanceTable">
                        <tr><td colspan="6" class="loading">Loading attendance...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Tests & Quizzes Section -->
        <section id="tests" class="content-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-family: 'Poppins', sans-serif;">
                    <i class="fas fa-file-pdf"></i> 
                    Tests & Quizzes
                </h3>
                <button class="btn btn-primary" onclick="openAddTestModal()" id="addTestBtn" style="display: none;">
                    <i class="fas fa-plus"></i> Add Test
                </button>
            </div>

            <div class="student-warning" id="testsWarning" style="display: none;">
                <i class="fas fa-download"></i> 
                Click download button to get test papers and quizzes
            </div>

            <div id="testsList">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading tests and quizzes...</p>
                </div>
            </div>
        </section>

        <!-- Feedback Section -->
        <section id="feedback" class="content-section">
            <div class="feedback-container">
                <h3 style="font-family: 'Poppins', sans-serif; margin-bottom: 25px;">
                    <i class="fas fa-star"></i> 
                    Student Feedback System
                </h3>
                
                <!-- Feedback Form (only for student view) -->
                <div class="feedback-form" id="feedbackForm">
                    <h4 style="margin-bottom: 20px; color: var(--primary);">
                        <i class="fas fa-comment-alt"></i> 
                        Submit Your Feedback
                    </h4>
                    
                    <div class="form-group">
                        <label class="required">Your Name</label>
                        <input type="text" id="feedbackName" class="form-control" placeholder="Enter your full name" required>
                        <small style="color: #666; font-size: 0.85rem;">Your name is required for feedback submission</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Phone Number (Optional)</label>
                        <input type="tel" id="feedbackPhone" class="form-control" placeholder="Enter your phone number">
                    </div>
                    
                    <div class="form-group">
                        <label class="required">Your Rating</label>
                        <div class="star-rating">
                            <input type="radio" id="star5" name="rating" value="5">
                            <label for="star5" title="5 stars - Excellent"></label>
                            <input type="radio" id="star4" name="rating" value="4">
                            <label for="star4" title="4 stars - Very Good"></label>
                            <input type="radio" id="star3" name="rating" value="3">
                            <label for="star3" title="3 stars - Good"></label>
                            <input type="radio" id="star2" name="rating" value="2">
                            <label for="star2" title="2 stars - Fair"></label>
                            <input type="radio" id="star1" name="rating" value="1">
                            <label for="star1" title="1 star - Poor"></label>
                        </div>
                        <div class="rating-text" id="ratingText">Select your rating</div>
                    </div>
                    
                    <div class="form-group">
                        <label>Your Feedback (Optional)</label>
                        <textarea id="feedbackText" class="form-control" rows="4" placeholder="Share your experience, suggestions, or comments about the classes..."></textarea>
                    </div>
                    
                    <button class="btn btn-success" onclick="submitFeedback()" style="margin-top: 10px;">
                        <i class="fas fa-paper-plane"></i> Submit Feedback
                    </button>
                </div>

                <!-- Feedback List -->
                <h4 style="margin: 30px 0 15px; font-family: 'Poppins', sans-serif;">
                    <i class="fas fa-list"></i> 
                    Recent Feedback
                </h4>
                <div class="feedback-list" id="feedbackList">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading feedback...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Teacher Section -->
        <section id="about" class="content-section">
            <div class="about-container">
                <div class="teacher-profile">
                    <div class="teacher-photo">
                        <img src="https://raw.githubusercontent.com/Satqm/Mithilesh-/main/Mithilesh.jpg" 
                             alt="Mr. Mithilesh" 
                             id="teacherImage"
                             onerror="this.onerror=null; this.src='https://via.placeholder.com/250/3a86ff/ffffff?text=Mr.+Mithilesh'">
                    </div>
                    
                    <div class="teacher-info">
                        <h2 id="teacherName">Mr. Mithilesh</h2>
                        <p id="teacherEmail">Mathematics Teacher & Mentor</p>
                        
                        <div class="contact-info">
                            <div class="contact-item" onclick="window.open('https://wa.me/919334420038', '_blank')">
                                <i class="fab fa-whatsapp"></i>
                                <span>WhatsApp: +91 93344 20038</span>
                            </div>
                            <div class="contact-item">
                                <i class="fas fa-envelope"></i>
                                <span id="teacherContactEmail">mithilesh.maths@gmail.com</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="qualification-grid">
                    <div class="qualification-card">
                        <h4><i class="fas fa-graduation-cap"></i> Qualifications</h4>
                        <ul id="qualificationsList">
                            <li>M.Sc. in Mathematics (Gold Medalist)</li>
                            <li>B.Ed. in Mathematics Education</li>
                            <li>CTET Qualified (Mathematics)</li>
                            <li>NET/JRF Qualified</li>
                            <li>Ph.D. in Mathematics (Pursuing)</li>
                        </ul>
                    </div>
                    
                    <div class="qualification-card">
                        <h4><i class="fas fa-chart-line"></i> Teaching Experience</h4>
                        <p id="experienceText">12+ years of teaching experience specializing in CBSE, ICSE, and State Board Mathematics for classes 9-12. Expert in preparing students for JEE Mains, JEE Advanced, and other competitive exams.</p>
                        <div style="margin-top: 15px; padding: 10px; background: rgba(58, 134, 255, 0.1); border-radius: 8px;">
                            <strong>Specializations:</strong>
                            <ul style="margin-top: 5px;">
                                <li>Algebra & Calculus</li>
                                <li>Geometry & Trigonometry</li>
                                <li>Statistics & Probability</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="qualification-card">
                        <h4><i class="fas fa-trophy"></i> Achievements</h4>
                        <ul id="achievementsList">
                            <li>1000+ Students Taught</li>
                            <li>95%+ Board Exam Success Rate</li>
                            <li>50+ JEE Advanced Selections</li>
                            <li>Best Teacher Award 2022</li>
                            <li>Student Satisfaction: 4.8/5</li>
                        </ul>
                    </div>
                </div>

                <!-- Edit Section (Teacher Only) -->
                <div id="editAboutSection" style="display: none; margin-top: 40px; padding-top: 30px; border-top: 2px solid #eee;">
                    <h4 style="margin-bottom: 25px; color: var(--primary);">
                        <i class="fas fa-edit"></i> Edit Teacher Profile
                    </h4>
                    
                    <div class="form-group">
                        <label>Teacher Name</label>
                        <input type="text" id="editTeacherName" class="form-control" value="Mr. Mithilesh">
                    </div>
                    
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="editTeacherEmail" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>Contact Number</label>
                        <input type="tel" id="editTeacherPhone" class="form-control" value="+91 93344 20038">
                    </div>
                    
                    <div class="form-group">
                        <label>Teaching Experience</label>
                        <textarea id="editTeacherExperience" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Qualifications (One per line)</label>
                        <textarea id="editTeacherQualifications" class="form-control" rows="4" placeholder="M.Sc. in Mathematics\nB.Ed. in Mathematics\nCTET Qualified"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Achievements (One per line)</label>
                        <textarea id="editTeacherAchievements" class="form-control" rows="4" placeholder="1000+ Students Taught\n95%+ Board Exam Success Rate"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Teacher Photo URL</label>
                        <input type="text" id="editTeacherPhoto" class="form-control" value="https://raw.githubusercontent.com/Satqm/Mithilesh-/main/Mithilesh.jpg">
                        <small>Use GitHub raw image URL (not blob link)</small>
                    </div>
                    
                    <button class="btn btn-primary" onclick="updateTeacherProfile()" style="margin-top: 10px;">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>

                <!-- Edit Button (Teacher Only) -->
                <div id="editAboutButton" style="display: none; margin-top: 30px; text-align: center;">
                    <button class="btn btn-outline" onclick="toggleEditAbout()" id="editAboutBtn">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="addStudentModal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Add New Student</h3>
                <button onclick="closeModal('addStudentModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Student Name</label>
                    <input type="text" id="studentName" class="form-control" placeholder="Rohan Sharma">
                </div>
                <div class="form-group">
                    <label>Father's Name</label>
                    <input type="text" id="fatherName" class="form-control" placeholder="Mr. Sharma">
                </div>
                <div class="form-group">
                    <label>Class</label>
                    <select id="studentClass" class="form-control">
                        <option value="9">Grade 9</option>
                        <option value="10">Grade 10</option>
                        <option value="11">Grade 11</option>
                        <option value="12">Grade 12</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Mobile Number</label>
                    <input type="tel" id="studentMobile" class="form-control" placeholder="9876543210">
                </div>
                <div class="form-group">
                    <label>Monthly Fee (₹)</label>
                    <input type="number" id="monthlyFee" class="form-control" placeholder="3500">
                </div>
                <button class="btn btn-primary" onclick="addStudent()">
                    <i class="fas fa-save"></i> Save Student
                </button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="addTestModal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-file-upload"></i> Add Monthly Test</h3>
                <button onclick="closeModal('addTestModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Test Title</label>
                    <input type="text" id="testTitle" class="form-control" placeholder="Algebra Monthly Test">
                </div>
                <div class="form-group">
                    <label>For Class</label>
                    <select id="testClass" class="form-control">
                        <option value="all">All Classes</option>
                        <option value="9">Grade 9</option>
                        <option value="10">Grade 10</option>
                        <option value="11">Grade 11</option>
                        <option value="12">Grade 12</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Test Date</label>
                    <input type="date" id="testDate" class="form-control">
                </div>
                <div class="form-group">
                    <label>PDF Link (Google Drive or similar)</label>
                    <input type="url" id="testLink" class="form-control" placeholder="https://drive.google.com/file/...">
                </div>
                <button class="btn btn-primary" onclick="addTest()">
                    <i class="fas fa-save"></i> Save Test
                </button>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div class="toast" id="successToast">
        <i class="fas fa-check-circle"></i> <span id="toastMessage">Success!</span>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDGYTU5iVTB7nY5poEH1FIeSyDvc9Io9sw",
            authDomain: "math-classes-by-mithilesh.firebaseapp.com",
            projectId: "math-classes-by-mithilesh",
            storageBucket: "math-classes-by-mithilesh.firebasestorage.app",
            messagingSenderId: "1095462608716",
            appId: "1:1095462608716:web:45667272a197a63fed79e9"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global variables
        let currentUser = null;
        let userRole = null; // 'teacher' or 'student'
        const FIXED_PASSWORD = "S@tyam"; // Fixed password for teacher

        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const app = document.getElementById('app');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const userRoleElement = document.getElementById('userRole');
        const userAvatar = document.getElementById('userAvatar');

        // Initialize app - FIXED: Stay logged in on refresh
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            const userMode = localStorage.getItem('userMode');
            const teacherLoggedIn = localStorage.getItem('teacherLoggedIn');
            
            if (userMode === 'student') {
                // Student mode
                userRole = 'student';
                showApp();
                loadStudentData();
            } else if (teacherLoggedIn === 'true') {
                // Teacher mode
                userRole = 'teacher';
                showApp();
                loadTeacherData();
            }
        });

        // Show login options
        function showLoginOptions() {
            document.getElementById('teacherLoginForm').style.display = 'none';
            document.querySelector('.login-options').style.display = 'flex';
        }

        // Show teacher login form
        function showTeacherLogin() {
            document.querySelector('.login-options').style.display = 'none';
            document.getElementById('teacherLoginForm').style.display = 'block';
        }

        // Teacher login function with fixed password
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email) {
                showToast('Please enter teacher email');
                return;
            }
            
            if (password !== FIXED_PASSWORD) {
                showToast('Incorrect password');
                return;
            }
            
            try {
                // Try to sign in with Firebase
                await auth.signInWithEmailAndPassword(email, password);
                userRole = 'teacher';
                
                // Store login state
                localStorage.setItem('userMode', 'teacher');
                localStorage.setItem('teacherLoggedIn', 'true');
                
                // Set teacher role in Firestore
                const user = auth.currentUser;
                await db.collection('users').doc(user.uid).set({
                    name: 'Mr. Mithilesh',
                    email: email,
                    role: 'teacher',
                    lastLogin: new Date()
                }, { merge: true });
                
                showApp();
                loadTeacherData();
                showToast('Teacher login successful!');
                
            } catch (error) {
                // If teacher doesn't exist in Firebase, create account
                if (error.code === 'auth/user-not-found') {
                    try {
                        // Create teacher account
                        await auth.createUserWithEmailAndPassword(email, password);
                        userRole = 'teacher';
                        
                        // Store login state
                        localStorage.setItem('userMode', 'teacher');
                        localStorage.setItem('teacherLoggedIn', 'true');
                        
                        // Create teacher document
                        const user = auth.currentUser;
                        await db.collection('users').doc(user.uid).set({
                            name: 'Mr. Mithilesh',
                            email: email,
                            role: 'teacher',
                            createdAt: new Date()
                        });
                        
                        // Create default teacher profile
                        await db.collection('teacherProfile').doc('profile').set({
                            name: 'Mr. Mithilesh',
                            email: email,
                            phone: '+91 93344 20038',
                            experience: '12+ years of teaching experience specializing in CBSE, ICSE, and State Board Mathematics for classes 9-12.',
                            qualifications: ['M.Sc. in Mathematics (Gold Medalist)', 'B.Ed. in Mathematics Education', 'CTET Qualified (Mathematics)', 'NET/JRF Qualified'],
                            achievements: ['1000+ Students Taught', '95%+ Board Exam Success Rate', '50+ JEE Advanced Selections', 'Best Teacher Award 2022'],
                            photoUrl: 'https://raw.githubusercontent.com/Satqm/Mithilesh-/main/Mithilesh.jpg'
                        });
                        
                        showApp();
                        loadTeacherData();
                        showToast('Teacher account created successfully!');
                        
                    } catch (createError) {
                        showToast('Error creating account: ' + createError.message);
                    }
                } else {
                    showToast('Login error: ' + error.message);
                }
            }
        }

        // Enter student mode (no login required) - FIXED: Save state
        function enterStudentMode() {
            userRole = 'student';
            localStorage.setItem('userMode', 'student');
            localStorage.removeItem('teacherLoggedIn');
            showApp();
            loadStudentData();
            showToast('Student mode activated. You can view information and submit feedback.');
        }

        // Show main app
        function showApp() {
            loginScreen.style.display = 'none';
            app.style.display = 'block';
            
            if (userRole === 'teacher') {
                welcomeMessage.textContent = 'Welcome, Teacher!';
                userRoleElement.textContent = 'Teacher Dashboard';
                userAvatar.textContent = 'T';
                document.getElementById('logoutBtn').innerHTML = '<i class="fas fa-sign-out-alt"></i> Logout';
                
                // Show teacher-only elements
                document.getElementById('addStudentBtn').style.display = 'block';
                document.getElementById('addTestBtn').style.display = 'block';
                document.getElementById('attendanceActions').style.display = 'flex';
                document.getElementById('editAboutButton').style.display = 'block';
                document.getElementById('studentsTitle').textContent = 'Student Management';
                
                // Hide student elements
                document.getElementById('studentNotice').style.display = 'none';
                document.getElementById('studentViewWarning').style.display = 'none';
                document.getElementById('attendanceWarning').style.display = 'none';
                document.getElementById('testsWarning').style.display = 'none';
                document.getElementById('studentDashboard').style.display = 'none';
                document.getElementById('feedbackForm').style.display = 'none';
                
            } else {
                welcomeMessage.textContent = 'Welcome to Math Classes!';
                userRoleElement.textContent = 'Student Access Portal';
                userAvatar.textContent = 'S';
                document.getElementById('logoutBtn').innerHTML = '<i class="fas fa-home"></i> Back to Login';
                
                // Show student elements
                document.getElementById('studentNotice').style.display = 'block';
                document.getElementById('studentViewWarning').style.display = 'block';
                document.getElementById('attendanceWarning').style.display = 'block';
                document.getElementById('testsWarning').style.display = 'block';
                document.getElementById('studentDashboard').style.display = 'block';
                document.getElementById('feedbackForm').style.display = 'block';
                document.getElementById('studentsTitle').textContent = 'Class Students';
                
                // Hide teacher-only elements
                document.getElementById('addStudentBtn').style.display = 'none';
                document.getElementById('addTestBtn').style.display = 'none';
                document.getElementById('attendanceActions').style.display = 'none';
                document.getElementById('editAboutButton').style.display = 'none';
                document.getElementById('editAboutSection').style.display = 'none';
            }
        }

        // Load teacher data
        async function loadTeacherData() {
            try {
                // Load dashboard stats
                const students = await db.collection('students').get();
                document.getElementById('totalStudents').textContent = students.size;
                
                // Calculate today's attendance
                const today = new Date().toISOString().split('T')[0];
                const attendance = await db.collection('attendance')
                    .where('date', '==', today)
                    .get();
                
                const presentCount = attendance.docs.filter(doc => doc.data().status === 'present').length;
                const totalStudents = students.size;
                const attendancePercent = totalStudents > 0 ? Math.round((presentCount / totalStudents) * 100) : 0;
                document.getElementById('attendancePercent').textContent = attendancePercent + '%';
                
                // Load fees data
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                const fees = await db.collection('fees')
                    .where('month', '==', currentMonth)
                    .where('year', '==', currentYear)
                    .get();
                
                let feesCollected = 0;
                fees.forEach(doc => {
                    feesCollected += parseFloat(doc.data().amount || 0);
                });
                document.getElementById('feesCollected').textContent = '₹' + feesCollected;
                
                // Load pending fees
                let pendingFees = 0;
                students.forEach(doc => {
                    const data = doc.data();
                    pendingFees += parseFloat(data.feePending || 0);
                });
                document.getElementById('pendingFees').textContent = '₹' + pendingFees;
                
                // Load activities
                loadActivities();
                
                // Load students list
                loadStudents();
                
                // Load attendance
                loadAttendance();
                
                // Load tests
                loadTests();
                
                // Load feedback
                loadFeedback();
                
                // Load teacher profile
                loadTeacherProfile();
                
            } catch (error) {
                console.error('Error loading teacher data:', error);
                showToast('Error loading data: ' + error.message);
            }
        }

        // Load student data (read-only)
        async function loadStudentData() {
            try {
                // Load basic info
                const students = await db.collection('students').get();
                document.getElementById('totalStudents').textContent = students.size;
                
                // Set attendance percentage (demo)
                document.getElementById('attendancePercent').textContent = '85%';
                document.getElementById('feesCollected').textContent = 'N/A';
                document.getElementById('pendingFees').textContent = 'N/A';
                
                // Load activities
                loadActivities();
                
                // Load teacher profile
                loadTeacherProfile();
                
                // Load tests for download
                loadTests();
                
                // Load attendance (read-only)
                loadAttendance();
                
                // Load students list (read-only)
                loadStudents();
                
                // Load feedback
                loadFeedback();
                
            } catch (error) {
                console.error('Error loading student data:', error);
                showToast('Error loading student data');
            }
        }

        // Load teacher profile
        async function loadTeacherProfile() {
            try {
                const profileDoc = await db.collection('teacherProfile').doc('profile').get();
                if (profileDoc.exists) {
                    const data = profileDoc.data();
                    
                    // Update profile info
                    document.getElementById('teacherName').textContent = data.name || 'Mr. Mithilesh';
                    document.getElementById('teacherEmail').textContent = data.email || 'Mathematics Teacher';
                    document.getElementById('teacherContactEmail').textContent = data.email || 'mithilesh.maths@gmail.com';
                    document.getElementById('experienceText').textContent = data.experience || '12+ years of teaching experience.';
                    
                    // Update qualifications
                    const qualificationsList = document.getElementById('qualificationsList');
                    qualificationsList.innerHTML = '';
                    if (data.qualifications && Array.isArray(data.qualifications)) {
                        data.qualifications.forEach(qual => {
                            const li = document.createElement('li');
                            li.textContent = qual;
                            qualificationsList.appendChild(li);
                        });
                    }
                    
                    // Update achievements
                    const achievementsList = document.getElementById('achievementsList');
                    achievementsList.innerHTML = '';
                    if (data.achievements && Array.isArray(data.achievements)) {
                        data.achievements.forEach(ach => {
                            const li = document.createElement('li');
                            li.textContent = ach;
                            achievementsList.appendChild(li);
                        });
                    }
                    
                    // Update edit form
                    document.getElementById('editTeacherName').value = data.name || 'Mr. Mithilesh';
                    document.getElementById('editTeacherEmail').value = data.email || '';
                    document.getElementById('editTeacherPhone').value = data.phone || '+91 93344 20038';
                    document.getElementById('editTeacherExperience').value = data.experience || '';
                    document.getElementById('editTeacherQualifications').value = (data.qualifications || []).join('\n');
                    document.getElementById('editTeacherAchievements').value = (data.achievements || []).join('\n');
                    document.getElementById('editTeacherPhoto').value = data.photoUrl || 'https://raw.githubusercontent.com/Satqm/Mithilesh-/main/Mithilesh.jpg';
                    
                    // Update photo if URL exists
                    if (data.photoUrl) {
                        document.getElementById('teacherImage').src = data.photoUrl;
                    }
                }
            } catch (error) {
                console.error('Error loading teacher profile:', error);
            }
        }

        // Show section
        function showSection(sectionId) {
            // Update active tab
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show section
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        // Load students - FIXED: Improved UI and removed fees for students
        async function loadStudents() {
            try {
                const studentsSnapshot = await db.collection('students').orderBy('name').get();
                const studentsList = document.getElementById('studentsList');
                
                if (studentsSnapshot.empty) {
                    studentsList.innerHTML = '<div class="loading">No students found</div>';
                    return;
                }
                
                let html = '';
                studentsSnapshot.forEach(doc => {
                    const student = doc.data();
                    const firstLetter = student.name ? student.name.charAt(0).toUpperCase() : 'S';
                    
                    if (userRole === 'teacher') {
                        // Teacher view with all info
                        html += `
                            <div class="student-card">
                                <div class="student-avatar">${firstLetter}</div>
                                <div>
                                    <h3 style="margin-bottom: 10px; color: var(--primary);">${student.name}</h3>
                                    <div class="student-info-grid">
                                        <div class="student-info-item">
                                            <strong>Father's Name</strong>
                                            <span>${student.fatherName || 'Not specified'}</span>
                                        </div>
                                        <div class="student-info-item">
                                            <strong>Class</strong>
                                            <span>Grade ${student.class}</span>
                                        </div>
                                        <div class="student-info-item">
                                            <strong>Mobile</strong>
                                            <span>${student.mobile || 'Not specified'}</span>
                                        </div>
                                        <div class="student-info-item">
                                            <strong>Monthly Fee</strong>
                                            <span>₹${student.monthlyFee || 0}</span>
                                        </div>
                                        <div class="student-info-item">
                                            <strong>Pending Fee</strong>
                                            <span>₹${student.feePending || 0}</span>
                                        </div>
                                    </div>
                                    <div class="action-buttons">
                                        <button class="action-btn action-btn-primary" onclick="editStudent('${doc.id}')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                        <button class="action-btn action-btn-danger" onclick="deleteStudent('${doc.id}')">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        // Student view without fees
                        html += `
                            <div class="student-card">
                                <div class="student-avatar">${firstLetter}</div>
                                <div>
                                    <h3 style="margin-bottom: 10px; color: var(--primary);">${student.name}</h3>
                                    <div class="student-info-grid">
                                        <div class="student-info-item">
                                            <strong>Father's Name</strong>
                                            <span>${student.fatherName || 'Not specified'}</span>
                                        </div>
                                        <div class="student-info-item">
                                            <strong>Class</strong>
                                            <span>Grade ${student.class}</span>
                                        </div>
                                        <div class="student-info-item">
                                            <strong>Mobile</strong>
                                            <span>${student.mobile || 'Not specified'}</span>
                                        </div>
                                        <div class="student-info-item">
                                            <strong>Joined</strong>
                                            <span>${student.createdAt ? new Date(student.createdAt.seconds * 1000).toLocaleDateString() : 'Recent'}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                });
                
                studentsList.innerHTML = html;
            } catch (error) {
                console.error('Error loading students:', error);
                document.getElementById('studentsList').innerHTML = '<div class="loading">Error loading students</div>';
            }
        }

        // Load tests
        async function loadTests() {
            try {
                const testsSnapshot = await db.collection('tests').orderBy('date', 'desc').get();
                const testsList = document.getElementById('testsList');
                
                if (testsSnapshot.empty) {
                    testsList.innerHTML = '<div class="loading">No tests available yet</div>';
                    return;
                }
                
                let html = '';
                testsSnapshot.forEach(doc => {
                    const test = doc.data();
                    const testDate = test.date ? new Date(test.date.seconds * 1000).toLocaleDateString() : 'Not specified';
                    
                    html += `
                        <div class="test-card">
                            <div class="test-header">
                                <div class="test-title">${test.title}</div>
                                <div class="test-class">Grade ${test.class === 'all' ? 'All' : test.class}</div>
                            </div>
                            <p><strong>Date:</strong> ${testDate}</p>
                            <p><strong>Description:</strong> Monthly test paper for practice</p>
                            <div class="test-actions">
                                <button class="btn btn-primary download-btn" onclick="window.open('${test.link}', '_blank')">
                                    <i class="fas fa-download"></i> Download Test PDF
                                </button>
                                ${userRole === 'teacher' ? `
                                <button class="btn btn-danger" onclick="deleteTest('${doc.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                testsList.innerHTML = html;
            } catch (error) {
                console.error('Error loading tests:', error);
                document.getElementById('testsList').innerHTML = '<div class="loading">Error loading tests</div>';
            }
        }

        // Load feedback
        async function loadFeedback() {
            try {
                const feedbackSnapshot = await db.collection('feedback').orderBy('timestamp', 'desc').limit(10).get();
                const feedbackList = document.getElementById('feedbackList');
                
                if (feedbackSnapshot.empty) {
                    feedbackList.innerHTML = '<div class="loading">No feedback yet. Be the first to submit!</div>';
                    return;
                }
                
                let html = '';
                feedbackSnapshot.forEach(doc => {
                    const feedback = doc.data();
                    const date = feedback.timestamp ? new Date(feedback.timestamp.seconds * 1000).toLocaleDateString() : 'Recently';
                    const stars = '★'.repeat(feedback.rating) + '☆'.repeat(5 - feedback.rating);
                    
                    html += `
                        <div class="feedback-item">
                            <div class="feedback-header">
                                <div>
                                    <strong>${feedback.name || 'Anonymous'}</strong>
                                    ${feedback.phone ? `<br><small style="color: #666;">${feedback.phone}</small>` : ''}
                                </div>
                                <div class="feedback-date">${date}</div>
                            </div>
                            <div class="feedback-stars" title="${feedback.rating} stars">
                                ${stars} (${feedback.rating}/5)
                            </div>
                            <p style="margin-top: 10px; color: #555;">${feedback.text || 'No comment provided'}</p>
                        </div>
                    `;
                });
                
                feedbackList.innerHTML = html;
            } catch (error) {
                console.error('Error loading feedback:', error);
            }
        }

        // Submit feedback (student only) - FIXED: Name is required
        async function submitFeedback() {
            if (userRole !== 'student') {
                showToast('Only students can submit feedback');
                return;
            }
            
            const rating = document.querySelector('input[name="rating"]:checked');
            const name = document.getElementById('feedbackName').value.trim();
            const phone = document.getElementById('feedbackPhone').value.trim();
            const text = document.getElementById('feedbackText').value.trim();
            
            if (!rating) {
                showToast('Please select a rating');
                return;
            }
            
            if (!name) {
                showToast('Please enter your name');
                document.getElementById('feedbackName').focus();
                return;
            }
            
            try {
                await db.collection('feedback').add({
                    rating: parseInt(rating.value),
                    name: name,
                    phone: phone || '',
                    text: text || '',
                    timestamp: new Date()
                });
                
                // Reset form
                document.querySelectorAll('input[name="rating"]').forEach(input => input.checked = false);
                document.getElementById('feedbackName').value = '';
                document.getElementById('feedbackPhone').value = '';
                document.getElementById('feedbackText').value = '';
                document.getElementById('ratingText').textContent = 'Select your rating';
                
                showToast('Thank you for your feedback!');
                loadFeedback();
                
            } catch (error) {
                console.error('Error submitting feedback:', error);
                showToast('Error submitting feedback: ' + error.message);
            }
        }

        // Update teacher profile
        async function updateTeacherProfile() {
            if (userRole !== 'teacher') return;
            
            try {
                const profileData = {
                    name: document.getElementById('editTeacherName').value,
                    email: document.getElementById('editTeacherEmail').value,
                    phone: document.getElementById('editTeacherPhone').value,
                    experience: document.getElementById('editTeacherExperience').value,
                    qualifications: document.getElementById('editTeacherQualifications').value.split('\n').filter(q => q.trim()),
                    achievements: document.getElementById('editTeacherAchievements').value.split('\n').filter(a => a.trim()),
                    photoUrl: document.getElementById('editTeacherPhoto').value,
                    updatedAt: new Date()
                };
                
                await db.collection('teacherProfile').doc('profile').set(profileData, { merge: true });
                
                showToast('Profile updated successfully!');
                loadTeacherProfile();
                toggleEditAbout();
                
            } catch (error) {
                showToast('Error updating profile: ' + error.message);
            }
        }

        // Add student
        async function addStudent() {
            if (userRole !== 'teacher') return;
            
            const studentData = {
                name: document.getElementById('studentName').value.trim(),
                fatherName: document.getElementById('fatherName').value.trim(),
                class: document.getElementById('studentClass').value,
                mobile: document.getElementById('studentMobile').value.trim(),
                monthlyFee: parseFloat(document.getElementById('monthlyFee').value) || 0,
                feePending: parseFloat(document.getElementById('monthlyFee').value) || 0,
                createdAt: new Date()
            };
            
            if (!studentData.name) {
                showToast('Please enter student name');
                return;
            }
            
            try {
                await db.collection('students').add(studentData);
                closeModal('addStudentModal');
                showToast('Student added successfully!');
                loadStudents();
                loadTeacherData();
                
                // Clear form
                document.getElementById('studentName').value = '';
                document.getElementById('fatherName').value = '';
                document.getElementById('studentMobile').value = '';
                document.getElementById('monthlyFee').value = '';
                
            } catch (error) {
                showToast('Error adding student: ' + error.message);
            }
        }

        // Add test
        async function addTest() {
            if (userRole !== 'teacher') return;
            
            const testData = {
                title: document.getElementById('testTitle').value.trim(),
                class: document.getElementById('testClass').value,
                date: new Date(document.getElementById('testDate').value || new Date()),
                link: document.getElementById('testLink').value.trim(),
                createdAt: new Date()
            };
            
            if (!testData.title || !testData.link) {
                showToast('Please enter test title and link');
                return;
            }
            
            if (!testData.link.startsWith('http')) {
                showToast('Please enter a valid URL starting with http:// or https://');
                return;
            }
            
            try {
                await db.collection('tests').add(testData);
                closeModal('addTestModal');
                showToast('Test added successfully!');
                loadTests();
                
                // Clear form
                document.getElementById('testTitle').value = '';
                document.getElementById('testLink').value = '';
                
            } catch (error) {
                showToast('Error adding test: ' + error.message);
            }
        }

        // Open modals
        function openAddStudentModal() {
            if (userRole !== 'teacher') return;
            document.getElementById('addStudentModal').classList.add('active');
        }

        function openAddTestModal() {
            if (userRole !== 'teacher') return;
            document.getElementById('testDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('addTestModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Toggle edit about section
        function toggleEditAbout() {
            if (userRole !== 'teacher') return;
            const editSection = document.getElementById('editAboutSection');
            editSection.style.display = editSection.style.display === 'none' ? 'block' : 'none';
        }

        // Logout - FIXED: Clear all localStorage
        function logout() {
            localStorage.removeItem('userMode');
            localStorage.removeItem('teacherLoggedIn');
            if (userRole === 'teacher') {
                auth.signOut();
            }
            location.reload();
        }

        // Show toast message
        function showToast(message) {
            const toast = document.getElementById('successToast');
            document.getElementById('toastMessage').textContent = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Star rating hover effect
        document.querySelectorAll('.star-rating input').forEach(input => {
            input.addEventListener('change', function() {
                const ratingText = document.getElementById('ratingText');
                const ratings = {
                    1: 'Poor - Needs improvement',
                    2: 'Fair - Below expectations',
                    3: 'Good - Met expectations',
                    4: 'Very Good - Exceeded expectations',
                    5: 'Excellent - Outstanding'
                };
                ratingText.textContent = ratings[this.value] || 'Select your rating';
            });
        });

        // Initialize star rating text
        document.querySelectorAll('.star-rating label').forEach(label => {
            label.addEventListener('mouseover', function() {
                const input = document.querySelector('input[name="rating"]:checked');
                if (!input) {
                    document.getElementById('ratingText').textContent = this.title;
                }
            });
            label.addEventListener('mouseout', function() {
                const input = document.querySelector('input[name="rating"]:checked');
                const ratings = {
                    1: 'Poor - Needs improvement',
                    2: 'Fair - Below expectations',
                    3: 'Good - Met expectations',
                    4: 'Very Good - Exceeded expectations',
                    5: 'Excellent - Outstanding'
                };
                document.getElementById('ratingText').textContent = input ? ratings[input.value] : 'Select your rating';
            });
        });

        // Search students
        function searchStudents() {
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            const studentCards = document.querySelectorAll('.student-card');
            
            let foundCount = 0;
            studentCards.forEach(card => {
                const text = card.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    card.style.display = 'grid';
                    foundCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Show message if no results
            if (searchTerm && foundCount === 0) {
                document.getElementById('studentsList').innerHTML += `
                    <div style="text-align: center; padding: 20px; color: #666;">
                        <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>No students found matching "${searchTerm}"</p>
                    </div>
                `;
            }
        }

        // Load attendance
        async function loadAttendance() {
            try {
                const students = await db.collection('students').get();
                
                let html = '';
                students.forEach(doc => {
                    const student = doc.data();
                    // Generate realistic attendance data
                    const todayStatus = Math.random() > 0.2 ? 'Present' : 'Absent';
                    const weekPresent = Math.floor(Math.random() * 5) + 1;
                    const monthPresent = Math.floor(Math.random() * 20) + 10;
                    const attendancePercent = Math.floor((monthPresent / 30) * 100);
                    
                    html += `
                        <tr>
                            <td>${student.name}</td>
                            <td>Grade ${student.class}</td>
                            <td><span class="badge ${todayStatus === 'Present' ? 'badge-success' : 'badge-danger'}">${todayStatus}</span></td>
                            <td>${weekPresent}/5 days</td>
                            <td>${monthPresent}/30 days</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span>${attendancePercent}%</span>
                                    <div style="flex: 1; height: 8px; background: #eee; border-radius: 4px; overflow: hidden;">
                                        <div style="width: ${attendancePercent}%; height: 100%; background: ${attendancePercent > 80 ? 'var(--success)' : attendancePercent > 60 ? 'var(--warning)' : 'var(--danger)'};"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                document.getElementById('attendanceTable').innerHTML = html;
            } catch (error) {
                console.error('Error loading attendance:', error);
                document.getElementById('attendanceTable').innerHTML = '<tr><td colspan="6" class="loading">Error loading attendance</td></tr>';
            }
        }

        // Load activities
        async function loadActivities() {
            // For demo, create sample activities
            const activities = userRole === 'teacher' ? [
                { date: 'Today', activity: 'New student enrolled - Rohan Sharma', status: 'Completed' },
                { date: 'Yesterday', activity: 'Monthly fees collected - ₹15,000', status: 'Completed' },
                { date: '2 days ago', activity: 'Algebra test uploaded for Grade 10', status: 'Completed' },
                { date: '1 week ago', activity: 'Parent meeting scheduled', status: 'Pending' },
                { date: '2 weeks ago', activity: 'New study material added', status: 'Completed' }
            ] : [
                { date: 'Today', activity: 'Algebra class completed', status: 'Attended' },
                { date: 'Yesterday', activity: 'Geometry assignment submitted', status: 'Completed' },
                { date: '3 days ago', activity: 'Monthly test downloaded', status: 'Completed' },
                { date: '1 week ago', activity: 'Feedback submitted', status: 'Completed' }
            ];
            
            let html = '';
            activities.forEach(activity => {
                const statusClass = activity.status === 'Completed' || activity.status === 'Attended' ? 'badge-success' : 'badge-warning';
                html += `
                    <tr>
                        <td>${activity.date}</td>
                        <td>${activity.activity}</td>
                        <td><span class="badge ${statusClass}">${activity.status}</span></td>
                    </tr>
                `;
            });
            
            document.getElementById('activitiesList').innerHTML = html;
        }

        // Mark attendance for today (teacher only)
        async function markAttendanceToday() {
            if (userRole !== 'teacher') return;
            showToast('Attendance marking feature will be implemented here');
        }

        // Delete student (teacher only)
        async function deleteStudent(studentId) {
            if (userRole !== 'teacher') return;
            if (confirm('Are you sure you want to delete this student? This action cannot be undone.')) {
                try {
                    await db.collection('students').doc(studentId).delete();
                    showToast('Student deleted successfully!');
                    loadStudents();
                } catch (error) {
                    showToast('Error deleting student: ' + error.message);
                }
            }
        }

        // Delete test (teacher only)
        async function deleteTest(testId) {
            if (userRole !== 'teacher') return;
            if (confirm('Are you sure you want to delete this test?')) {
                try {
                    await db.collection('tests').doc(testId).delete();
                    showToast('Test deleted successfully!');
                    loadTests();
                } catch (error) {
                    showToast('Error deleting test: ' + error.message);
                }
            }
        }

        // Edit student (placeholder)
        function editStudent(studentId) {
            showToast('Edit student feature will be implemented in next version');
        }

        // Initialize star rating text on page load
        document.addEventListener('DOMContentLoaded', function() {
            const ratingText = document.getElementById('ratingText');
            ratingText.textContent = 'Select your rating';
        });
    </script>
</body>
    </html>
